
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registration | Digital Dashh</title>
  <meta property="og:image" content="http://www.digitaldashh.com/assets/DDBLogo.jpeg" />
<meta property="og:image:width" content="1280" />
<meta property="og:image:height" content="640" />
<meta property="og:type" content="website" />
<meta property="og:title" content="Digital Dashh EventBoard" />
<meta property="og:description" content="A branded command center for event producers. See how Digital Dashh can streamline your entire event workflow." />
  <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Barlow', sans-serif;
      background-color: #f0f4f8;
      margin: 0;
      padding: 0;
      color: #1c1c3a;
    }
    .header {
      background-color: #1c1c3a;
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 24px;
      font-weight: bold;
    }
    .menu {
      background-color: #ffe066;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      padding: 12px;
    }
    .menu a {
      background-color: #6c79db;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: bold;
      text-decoration: none;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      padding: 30px;
      max-width: 1200px;
      margin: auto;
    }
    .card {
      background-color: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px 12px;
      font-size: 14px;
      text-align: left;
    }
    th {
      background-color: #f4f4f4;
    }
    tr:hover {
      background-color: #f1f7ff;
    }
    button {
      background-color: #6c79db;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 14px;
      cursor: pointer;
      margin-top: 10px;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    button:hover {
      background-color: #5a67d8;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    input, select {
      margin-top: 6px;
      margin-bottom: 10px;
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-family: 'Barlow', sans-serif;
      font-size: 14px;
      transition: background-color 0.3s ease;
    }
    input:focus, select:focus {
      background-color: #f1f7ff;
      outline: none;
      border-color: #6c79db;
    }
    table input, table select {
      padding: 4px 6px;
      font-size: 13px;
      height: 30px;
      width: 100%;
      box-sizing: border-box;
    }
    .divider {
      margin: 20px 0;
      border: 0;
      height: 1px;
      background: linear-gradient(to right, transparent, #ccc, transparent);
    }
    .save-message {
      color: green;
      font-weight: bold;
      margin-top: 8px;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .save-message.show {
      opacity: 1;
    }
    .progress-bar {
      width: 100%;
      height: 12px;
      background-color: #eee;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 8px;
      margin-bottom: 12px;
    }
    .progress-bar-fill {
      height: 100%;
      background-color: #6c79db;
      width: 0%;
      border-radius: 8px;
      transition: width 0.4s ease;
    }
  </style>
</head>
<body>
  <div class="header">Digital Dashh | Registration</div>

<div class="menu">
  <a href="overview.html">Overview</a>
  <a href="budget.html">Budget</a>
  <a href="venues.html">Venues</a>
  <a href="av.html">AV Production</a>
  <a href="content.html">Creative Content</a>
  <a href="sponsor-tracker.html">Sponsor Tracker</a>
  <a href="merch-inventory.html">Merch Inventory</a>
</div>

  <div class="grid">
    <div class="card">
      <h3>üìù Event Info</h3>
      <label for="eventName">Event Name</label>
      <input type="text" id="eventName" value="Annual Gala 2025">
      <label for="eventLocation">Location</label>
      <input type="text" id="eventLocation" value="New York, NY">
      <label for="eventDate">Date</label>
      <input type="date" id="eventDate" value="2025-06-30">
      <label for="eventCapacity">Capacity</label>
      <input type="number" id="eventCapacity" value="500">
      <hr class="divider">
      <button onclick="saveEventInfo()">üíæ Save Event Info</button>
      <div id="saveConfirmation" class="save-message">‚úÖ Saved!</div>
    </div>

    <div class="card">
      <h3>üìà Registration Summary</h3>
      <p id="totalReg">Total Registered: 0</p>
      <p id="capacity">Capacity: 0</p>
      <p id="checkedIn">Checked In: 0</p>
      <p id="remaining">Remaining: 0</p>
      <hr class="divider">
      <p id="percentFilled">Capacity Filled: 0%</p>
      <div class="progress-bar"><div class="progress-bar-fill" id="progressFill"></div></div>
      <p id="vipGeneralBreakdown">VIPs: 0 | General: 0</p>
      <p id="statusBreakdown">Confirmed: 0 | Pending: 0 | Invited: 0 | Declined: 0</p>
      <p id="invitationCount">Invitations Sent: 0</p>
      <button onclick="downloadCSV()">üì• Download CSV</button>
    </div>

    <div class="card" style="grid-column: span 2;">
      <h3>üîé Filter Attendees</h3>
      <div style="display: flex; gap: 20px; flex-wrap: wrap;">
        <div style="flex: 1;">
          <label for="filterType">Type</label>
          <select id="filterType" onchange="renderTables()" style="width: 100%;">
            <option value="">All</option>
            <option value="VIP">VIP</option>
            <option value="General">General</option>
            <option value="Panelist">Panelist</option>
          </select>
        </div>
        <div style="flex: 1;">
          <label for="filterStatus">Status</label>
          <select id="filterStatus" onchange="renderTables()" style="width: 100%;">
            <option value="">All</option>
            <option value="Confirmed">Confirmed</option>
            <option value="Pending">Pending</option>
               <option value="Invited">Invited</option>
               <option value="Declined">Declined</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card" style="grid-column: span 2;">
      <h3>üë• Attendee List</h3>
      <table>
        <thead>
          <tr><th>Name</th><th>Email</th><th>Type</th><th>Status</th><th>Actions</th></tr>
        </thead>
        <tbody id="attendeeTable"></tbody>
      </table>
      <button onclick="addAttendee()">‚ûï Add Attendee</button>
    </div>

<div class="card" style="grid-column: span 2;">
  <h3>üì§ Import Attendees via CSV</h3>
  <p>You can upload a CSV file with the following format:</p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Type (VIP, General, Panelist)</th>
        <th>Status (Confirmed, Pending, Invited, Declined)</th>
        <th>Checked In (TRUE or FALSE)</th>
        <th>Allergies</th>
        <th>Milk Preference</th>
        <th>Hotel Needed? (Yes or No)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Jane Doe</td>
        <td>jane@example.com</td>
        <td>VIP</td>
        <td>Confirmed</td>
        <td>TRUE</td>
        <td>Peanuts</td>
        <td>Oat</td>
        <td>Yes</td>
      </tr>
    </tbody>
  </table>
  <input type="file" id="csvUpload" accept=".csv">
  <p id="csvFeedback" style="margin-top: 8px; font-size: 14px; color: #cc3300;"></p>
<a href="/assets/attendee_template.csv" download>
  <button>üìÑ Download Template CSV</button>
  </a>
  <button onclick="parseCSV()">üì• Upload CSV</button>
  

  
</div>
    
    <div class="card" style="grid-column: span 2;">
      <h3>üçΩÔ∏è Lodging, Food & Beverage Details</h3>
      <table>
        <thead>
          <tr><th>Name</th><th>Allergies</th><th>Milk Preference</th><th>Hotel Needed?</th></tr>
        </thead>
        <tbody id="fnbTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCfgmw0XlHj3BY9A-CS1-u_n4TDUuTNqmM",
    authDomain: "digital-dashh.firebaseapp.com",
    projectId: "digital-dashh",
    storageBucket: "digital-dashh.appspot.com",
    messagingSenderId: "535613848097",
    appId: "1:535613848097:web:bcd4a58bf1bd9497e48160"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let skipped = 0;
  let attendees = [], fnbPrefs = [];
  let userId = null, eventId = localStorage.getItem('activeEventId');

  function renderTables() {
    const attendeeTable = document.getElementById('attendeeTable');
    const fnbTable = document.getElementById('fnbTable');
    attendeeTable.innerHTML = '';
    fnbTable.innerHTML = '';

    const filterType = document.getElementById('filterType')?.value || '';
    const filterStatus = document.getElementById('filterStatus')?.value || '';

    const typeCounts = {};
    let confirmedCount = 0, pendingCount = 0, invitedCount = 0, declinedCount = 0;

    let invitationCount = 0;

    
    attendees.forEach((attendee, index) => {
      if ((filterType && attendee.type !== filterType) || (filterStatus && attendee.status !== filterStatus)) return;

      const type = attendee.type || "Unknown";
      if (!typeCounts[type]) typeCounts[type] = 0;
      typeCounts[type]++;

     if (attendee.status === "Confirmed") confirmedCount++;
else if (attendee.status === "Pending") pendingCount++;
else if (attendee.status === "Invited") invitedCount++;
else if (attendee.status === "Declined") declinedCount++;

      if (
  attendee.status === "Invited" ||
  attendee.status === "Confirmed" ||
  attendee.status === "Declined"
) {
  invitationCount++;
}
   attendeeTable.innerHTML += `
  <tr>
    <td><input type="text" value="${attendee.name}" onchange="updateAttendee(${index}, 'name', this.value)"></td>
    <td><input type="email" value="${attendee.email}" onchange="updateAttendee(${index}, 'email', this.value)"></td>
    <td>
      <select onchange="updateAttendee(${index}, 'type', this.value)">
        <option value="VIP" ${attendee.type==='VIP'?'selected':''}>VIP</option>
        <option value="General" ${attendee.type==='General'?'selected':''}>General</option>
        <option value="Panelist" ${attendee.type==='Panelist'?'selected':''}>Panelist</option>
      </select>
    </td>
    <td>
      <select onchange="updateAttendee(${index}, 'status', this.value)">
        <option value="Confirmed" ${attendee.status==='Confirmed'?'selected':''}>Confirmed</option>
        <option value="Pending" ${attendee.status==='Pending'?'selected':''}>Pending</option>
        <option value="Invited" ${attendee.status==='Invited'?'selected':''}>Invited</option>
        <option value="Declined" ${attendee.status==='Declined'?'selected':''}>Declined</option>
        
      </select>
    </td>
    <td>
      <label style="font-size: 13px;">
        <input type="checkbox" ${attendee.checkedIn ? 'checked' : ''} onchange="updateAttendee(${index}, 'checkedIn', this.checked)">
        Checked In
      </label>
      <br><button onclick="removeAttendee(${index})">Remove</button>
    </td>
  </tr>`;
    });

    fnbPrefs.forEach((pref, idx) => {
      fnbTable.innerHTML += `
        <tr>
          <td>${pref.name}</td>
          <td><input type="text" value="${pref.allergies}" onchange="updateFnb(${idx}, 'allergies', this.value)"></td>
          <td><input type="text" value="${pref.milk}" onchange="updateFnb(${idx}, 'milk', this.value)"></td>
          <td>
            <select onchange="updateFnb(${idx}, 'hotel', this.value)">
              <option value="Yes" ${pref.hotel==='Yes'?'selected':''}>Yes</option>
              <option value="No" ${pref.hotel==='No'?'selected':''}>No</option>
            </select>
          </td>
        </tr>`;
    });

    const capacity = parseInt(document.getElementById('eventCapacity').value) || 0;
    const percentFilled = capacity > 0 ? Math.round((attendees.length / capacity) * 100) : 0;
    document.getElementById('totalReg').innerText = `Total Registered: ${attendees.length}`;
    document.getElementById('capacity').innerText = `Capacity: ${capacity}`;
   const checkedInCount = attendees.filter(a => a.checkedIn).length;
document.getElementById('checkedIn').innerText = `Checked In: ${checkedInCount}`;
    document.getElementById('remaining').innerText = `Remaining: ${capacity - attendees.length}`;
    document.getElementById('percentFilled').innerText = `Capacity Filled: ${percentFilled}%`;
    document.getElementById('statusBreakdown').innerText = `Confirmed: ${confirmedCount} | Pending: ${pendingCount}| Invited: ${invitedCount} | Declined: ${declinedCount}`;
    document.getElementById('invitationCount').innerText =
  `Invitations Sent: ${invitationCount}`;
    document.getElementById('progressFill').style.width = percentFilled + '%';
    document.getElementById('csvFeedback').innerText =
  skipped > 0 ? `‚ö†Ô∏è ${skipped} row(s) were skipped due to missing data or duplicates.` : '';

const warningMessage = document.getElementById('overCapacityWarning');
if (attendees.length > capacity) {
  if (!warningMessage) {
    const warning = document.createElement('p');
    warning.id = 'overCapacityWarning';
    warning.innerText = '‚ö†Ô∏è Over Capacity!';
    warning.style.color = 'red';
    warning.style.fontWeight = 'bold';
    warning.style.marginTop = '8px';
    document.querySelector('.card:nth-of-type(2)').appendChild(warning);
  }

  document.getElementById('capacity').style.color = 'red';
  document.getElementById('remaining').style.color = 'red';
} else {
  if (warningMessage) warningMessage.remove();
  document.getElementById('capacity').style.color = '';
  document.getElementById('remaining').style.color = '';
}
    
    const breakdown = Object.entries(typeCounts).map(([type, count]) => `${type}s: ${count}`).join(' | ');
    document.getElementById('vipGeneralBreakdown').innerText = breakdown;
  }

function updateAttendee(index, field, value) {
  attendees[index][field] = field === 'checkedIn' ? Boolean(value) : value;
  if (field === 'name') fnbPrefs[index].name = value;
  saveToFirestore();
  renderTables();
}

  function updateFnb(index, field, value) {
    fnbPrefs[index][field] = value;
    saveToFirestore();
    renderTables();
  }

function addAttendee() {
  const newAttendee = { name: '', email: '', type: 'General', status: 'Pending', checkedIn: false };
  const newPref = { name: '', allergies: '', milk: '', hotel: 'No' };
  attendees.push(newAttendee);
  fnbPrefs.push(newPref);

  // Clear filters so new row is visible
  document.getElementById('filterType').value = '';
  document.getElementById('filterStatus').value = '';

  saveToFirestore();
  renderTables();
}

  function removeAttendee(index) {
    attendees.splice(index, 1);
    fnbPrefs.splice(index, 1);
    saveToFirestore();
    renderTables();
  }

  function saveEventInfo() {
    const name = document.getElementById('eventName').value;
    const location = document.getElementById('eventLocation').value;
    const date = document.getElementById('eventDate').value;
    const capacity = parseInt(document.getElementById('eventCapacity').value);

    if (userId && eventId) {
      db.collection('users').doc(userId).collection('events').doc(eventId).set({
        eventName: name,
        eventLocation: location,
        eventDate: date,
        eventCapacity: capacity
      }, { merge: true });
    }
    saveToFirestore();

    const msg = document.getElementById('saveConfirmation');
    msg.classList.add('show');
    setTimeout(() => msg.classList.remove('show'), 2500);
  }

  function saveToFirestore() {
    if (!userId || !eventId) return;
    db.collection('users').doc(userId).collection('events').doc(eventId).set({
      attendees,
      fnbPrefs
    }, { merge: true });
  }

  function loadData() {
    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }
      userId = user.uid;
      if (!eventId) return;

      const docRef = db.collection('users').doc(userId).collection('events').doc(eventId);
      docRef.get().then(doc => {
        if (doc.exists) {
          const data = doc.data();
         attendees = (data.attendees || []).map(a => ({
  ...a,
  checkedIn: a.checkedIn === true
}));
fnbPrefs = data.fnbPrefs || fnbPrefs;

          document.getElementById('eventName').value = data.eventName || '';
          document.getElementById('eventLocation').value = data.eventLocation || '';
          document.getElementById('eventDate').value = data.eventDate || '';
          document.getElementById('eventCapacity').value = data.eventCapacity || '';
        }
        renderTables();
      });
    });
  }

  loadData();

  new Sortable(document.getElementById('attendeeTable'), {
  animation: 150,
  onEnd: function (evt) {
    const newOrder = Array.from(evt.to.children).map(row => {
      const inputs = row.querySelectorAll('input, select');
      return {
        name: inputs[0].value,
        email: inputs[1].value,
        type: inputs[2].value,
        status: inputs[3].value,
        checkedIn: inputs[4].checked
      };
    });

    const newPrefs = Array.from(evt.to.children).map(row => {
      const name = row.querySelector('input').value;
      const matching = fnbPrefs.find(p => p.name === name) || { allergies: '', milk: '', hotel: 'No' };
      return { name, ...matching };
    });

    attendees = newOrder;
    fnbPrefs = newPrefs;
    saveToFirestore();
    renderTables();
  }
});

  function handleCSVUploadClick() {
  document.getElementById('csvUpload').click();
}

  function parseCSV() {
  const file = document.getElementById('csvUpload').files[0];
  if (!file) {
    document.getElementById('csvFeedback').innerText = "‚ö†Ô∏è Please select a CSV file first.";
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const text = e.target.result;
    const lines = text.trim().split('\n');
    const header = lines.shift().split(',');
    const headerIndex = {};
    let skipped = 0;

    header.forEach((h, i) => {
      headerIndex[h.trim().toLowerCase()] = i;
    });

    const newAttendees = [];
    const newFnbPrefs = [];

    lines.forEach(line => {
      const values = line.split(',');
      const get = key => values[headerIndex[key.toLowerCase()]]?.trim() || "";

      const name = get("name");
      const email = get("email");
      const type = get("type");
      const status = get("status");
      const checkedIn = get("checked in").toLowerCase() === 'true';
      const allergies = get("allergies");
      const milk = get("milk preference");
      const hotel = get("hotel needed?");

      if (!name || !email) {
        skipped++;
        return;
      }

      if (!attendees.some(a => a.email === email)) {
        newAttendees.push({ name, email, type, status, checkedIn });
        newFnbPrefs.push({ name, allergies, milk, hotel });
      }
    });

    attendees = attendees.concat(newAttendees);
    fnbPrefs = fnbPrefs.concat(newFnbPrefs);

    saveToFirestore();
    renderTables();

    document.getElementById('csvFeedback').innerText = 
      skipped > 0 
        ? `‚ö†Ô∏è ${skipped} row(s) were skipped due to missing data or duplicates.` 
        : `‚úÖ CSV uploaded successfully!`;
  };

  reader.readAsText(file);
}

function saveEventInfo() {
  const name = document.getElementById("event-name").value.trim();
  const location = document.getElementById("event-location").value.trim();
  const date = document.getElementById("event-date").value;
  const capacity = parseInt(document.getElementById("event-capacity").value) || 0;

  const user = firebase.auth().currentUser;
  const eventId = localStorage.getItem("activeEventId");

  if (!user || !eventId) {
    alert("User not logged in or event ID missing.");
    return;
  }

  // Save to Firestore
  db.collection("users").doc(user.uid).collection("events").doc(eventId).set({
    eventName: name,
    eventLocation: location,
    eventDate: date,
    eventCapacity: capacity
  }, { merge: true })
  .then(() => {
    // Optional: Save to localStorage as fallback
    localStorage.setItem("eventName", name);
    localStorage.setItem("eventLocation", location);
    localStorage.setItem("eventDate", date);
    localStorage.setItem("eventCapacity", capacity);

    alert("‚úÖ Event info saved!");
  })
  .catch((error) => {
    console.error("‚ùå Error saving event info:", error);
    alert("Failed to save event info.");
  });
}
  
  
</script>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  
</body>
</html>
